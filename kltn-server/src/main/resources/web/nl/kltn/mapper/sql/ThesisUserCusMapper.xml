<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="web.nl.kltn.mapper.ThesisUserCusMapper">

    <resultMap type="web.nl.kltn.model.generator.ThesisUser" id="ThesisUser">
    	<id column="id" property="id" jdbcType="VARCHAR"/>
    	<result column="thesis_id" property="thesisId" jdbcType="VARCHAR"/>
    	<result column="user_id" property="userId" jdbcType="VARCHAR"/>
    	<result column="type" property="type" jdbcType="INTEGER"/>
    	<result column="status" property="status" jdbcType="INTEGER"/>
    	<result column="created_at" property="createdAt" jdbcType="BIGINT"/>
    	<result column="updated_at" property="updatedAt" jdbcType="BIGINT"/>
    </resultMap>

	<delete id="deleteByTheisId" parameterType="String">
		DELETE FROM thesis_user WHERE thesis_id = #{thesisId}
	</delete>

	<select id="search" resultMap="ThesisUser">
		SELECT
			tu.id,
			tu.thesis_id,
			tu.user_id,
			tu.type,
			tu.status,
			tu.created_at,
			tu.updated_at
		FROM
			thesis_user tu
		LEFT JOIN user u ON tu.user_id = u.user_id
		<where>
			<if test="thesisId != null">
				AND tu.thesis_id = #{thesisId}
			</if>
			AND tu.type = #{type}
			AND u.is_deleted = 0
			AND tu.is_deleted = 0
		</where>
	</select>
	
	<select id="searchByThesis">
		SELECT
			id,
			thesis_id,
			user_id,
			type,
			status,
			created_at,
			updated_at
		FROM
			thesis_user
		WHERE
			thesis_id = #{thesisId}
	</select>

</mapper>