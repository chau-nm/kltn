<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="web.nl.kltn.mapper.ThesisCusMapper">

	<resultMap type="web.nl.kltn.model.dto.ThesisDTO" id="ThesisDTO">
		<id column="id" property="id" jdbcType="VARCHAR"/>
		<result column="topic" property="topic" jdbcType="VARCHAR"/>
		<result column="description" property="description" jdbcType="VARCHAR"/>
		<result column="year" property="year" jdbcType="INTEGER"/>
		<result column="semester" property="semester" jdbcType="INTEGER"/>
		<result column="status" property="status" jdbcType="INTEGER"/>
		<result column="is_deleted" property="isDeleted" jdbcType="BIT"/>
		<result column="created_at" property="createdAt" jdbcType="BIGINT"/>
		<result column="updated_at" property="updatedAt" jdbcType="BIGINT"/>
	</resultMap>

	<select id="search"
		resultMap="ThesisDTO">
		<bind name="offset" value="(page - 1) * pageSize" />
		SELECT
			id,
			topic,
			description,
			year,
			semester,
			status,
			is_deleted,
			created_at,
			updated_at
		FROM thesis
		<where>
			<if
				test="searchCondition != null and searchCondition.topic != null">
				AND topic LIKE CONCAT('%', #{searchCondition.topic}, '%')
			</if>
			<if
				test="searchCondition != null and searchCondition.year != 0">
				AND year = #{searchCondition.year}
			</if>
			<if
				test="searchCondition != null and searchCondition.semester != 0">
				AND semester = #{searchCondition.semester}
			</if>
			<if
				test="searchCondition != null and searchCondition.status != 0">
				AND status = #{searchCondition.status}
			</if>
			AND is_deleted = 0
		</where>
		LIMIT #{pageSize} OFFSET #{offset}
	</select>
	
	<select id="getTotal"
		resultType="int">
		SELECT COUNT(id)
		FROM thesis
		<where>
			<if
				test="topic != null">
				AND topic LIKE CONCAT('%', #{topic}, '%')
			</if>
			<if
				test="year != 0">
				AND year = #{year}
			</if>
			<if
				test="semester != 0">
				AND semester = #{semester}
			</if>
			<if
				test="status != 0">
				AND status = #{status}
			</if>
			AND is_deleted = 0
		</where>
	</select>

</mapper>