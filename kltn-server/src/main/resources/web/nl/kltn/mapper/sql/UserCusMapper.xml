<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="web.nl.kltn.mapper.UserCusMapper">

	<resultMap type="web.nl.kltn.model.dto.UserDTO" id="UserDTO">
		<id column="user_id" property="userId" jdbcType="VARCHAR" />
		<result column="username" property="username" jdbcType="VARCHAR" />
		<result column="password" property="password" jdbcType="VARCHAR" />
		<result column="fname" property="fname" jdbcType="VARCHAR" />
		<result column="birthday" property="birthday" jdbcType="DATE" />
		<result column="faculty" property="faculty" jdbcType="VARCHAR" />
		<result column="student_class" property="studentClass" jdbcType="VARCHAR" />
		<collection property="roles" ofType="string" jdbcType="VARCHAR">
			<result column="role_name"/>
		</collection>
	</resultMap>


	<select id="login" parameterType="web.nl.kltn.model.LoginCondition" resultMap="UserDTO">
		SELECT 
			u.user_id,
			u.username,
			u.password,
			u.fname,
			u.birthday,
			u.faculty,
			u.student_class,
			r.role_name
		FROM
			user u
		LEFT JOIN role_user ru ON u.user_id = ru.user_id
		LEFT JOIN role r ON ru.role_id = r.role_id
		WHERE 
			u.username = '${username}'
		AND u.password = '${password}'
	</select>
	
	<select id="findByUserId" parameterType="java.lang.String" resultMap="UserDTO">
		SELECT 
			u.user_id,
			u.username,
			u.password,
			u.fname,
			u.birthday,
			u.faculty,
			u.student_class,
			r.role_name
		FROM
			user u
		LEFT JOIN role_user ru ON u.user_id = ru.user_id
		LEFT JOIN role r ON ru.role_id = r.role_id
		WHERE 
			u.user_id = '${userId}'
	</select>
	
	<select id="findByUsername" parameterType="java.lang.String" resultMap="UserDTO">
		SELECT 
			u.user_id,
			u.username,
			u.password,
			u.fname,
			u.birthday,
			u.faculty,
			u.student_class,
			r.role_name
		FROM
			user u
		LEFT JOIN role_user ru ON u.user_id = ru.user_id
		LEFT JOIN role r ON ru.role_id = r.role_id
		WHERE 
			u.username = '${username}'
	</select>

</mapper>